# ComBaseæ•°æ®çˆ¬å–å®Œæ•´æŒ‡å—

## ğŸ¯ é’ˆå¯¹ä½ çš„å…·ä½“éœ€æ±‚

ä½ æåˆ°çš„é—®é¢˜ï¼š
- âœ… **URLä¸å˜åŒ–**: å®Œå…¨æ”¯æŒAJAX/å•é¡µåº”ç”¨
- âœ… **5101é¡µæ•°æ®**: è‡ªåŠ¨åŒ–å¤„ç†æ‰€æœ‰é¡µé¢
- âœ… **æ‰‹åŠ¨æ“ä½œç¹ç**: å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€äººå·¥å¹²é¢„
- âœ… **Excelæ–‡ä»¶æ•´åˆ**: è‡ªåŠ¨åˆå¹¶æ‰€æœ‰ä¸‹è½½æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å·¥ä½œ
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. ç¡®ä¿æœ‰ComBaseè´¦å·
# å¦‚æœæ²¡æœ‰ï¼Œè¯·è®¿é—®: https://combasebrowser.errc.ars.usda.gov/SignUp.aspx
```

### ç¬¬äºŒæ­¥ï¼šåˆ†æç½‘ç«™ç»“æ„ï¼ˆé‡è¦ï¼ï¼‰
```bash
# è¿è¡Œç½‘ç«™åˆ†æå·¥å…·
python site_analyzer.py
```

è¿™ä¸ªå·¥å…·ä¼šï¼š
1. æ‰“å¼€ComBaseç™»å½•é¡µé¢
2. è®©ä½ æ‰‹åŠ¨ç™»å½•
3. åˆ†æé¡µé¢DOMç»“æ„
4. ç”Ÿæˆæ­£ç¡®çš„é€‰æ‹©å™¨é…ç½®

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°é…ç½®
æ ¹æ®åˆ†æç»“æœï¼Œæ›´æ–° `config.py` ä¸­çš„é€‰æ‹©å™¨ï¼š

```python
# åœ¨config.pyä¸­è®¾ç½®ç™»å½•ä¿¡æ¯
LOGIN_USERNAME = "your_username"
LOGIN_PASSWORD = "your_password"

# æ›´æ–°SELECTORSé…ç½®ï¼ˆæ ¹æ®site_analyzer.pyçš„è¾“å‡ºï¼‰
SELECTORS = {
    "username_input": "input[name='ctl00$ContentPlaceHolder1$txtUsername']",
    "password_input": "input[name='ctl00$ContentPlaceHolder1$txtPassword']",
    # ... å…¶ä»–é€‰æ‹©å™¨
}
```

### ç¬¬å››æ­¥ï¼šå¼€å§‹çˆ¬å–
```bash
# æ–¹å¼1: äº¤äº’å¼å¯åŠ¨
python run.py

# æ–¹å¼2: å‘½ä»¤è¡Œå¯åŠ¨
python run.py --username your_username --password your_password

# æ–¹å¼3: æµ‹è¯•å°‘é‡é¡µé¢
python run.py --start 1 --end 10 --username your_username
```

## ğŸ”§ é’ˆå¯¹AJAXç½‘ç«™çš„ç‰¹æ®Šå¤„ç†

### URLä¸å˜åŒ–çš„è§£å†³æ–¹æ¡ˆ
1. **ç­‰å¾…AJAXå®Œæˆ**: æ™ºèƒ½æ£€æµ‹é¡µé¢åŠ è½½çŠ¶æ€
2. **JavaScriptåˆ†é¡µ**: ä½¿ç”¨`__doPostBack`ç­‰ASP.NETå‡½æ•°
3. **DOMå˜åŒ–ç›‘æ§**: é€šè¿‡å…ƒç´ å˜åŒ–åˆ¤æ–­æ“ä½œæ˜¯å¦æˆåŠŸ
4. **ViewStateå¤„ç†**: è‡ªåŠ¨å¤„ç†ASP.NETçš„ViewStateæœºåˆ¶

### å…³é”®æŠ€æœ¯ç‚¹
```python
# ç­‰å¾…AJAXè¯·æ±‚å®Œæˆ
def _wait_for_ajax_complete(self):
    # ç­‰å¾…jQueryè¯·æ±‚å®Œæˆ
    WebDriverWait(self.driver, 30).until(
        lambda driver: driver.execute_script("return jQuery.active == 0")
    )
    
# JavaScriptåˆ†é¡µ
script = f"__doPostBack('ctl00$ContentPlaceHolder1$gvResults', 'Page${page_number}');"
self.driver.execute_script(script)
```

## ğŸ“Š æ•°æ®å¤„ç†æµç¨‹

```
ComBaseç½‘ç«™ â†’ ç™»å½• â†’ æœç´¢ç»“æœ â†’ åˆ†é¡µæµè§ˆ â†’ é€‰æ‹©æ•°æ® â†’ å¯¼å‡ºExcel
     â†“
è‡ªåŠ¨ä¸‹è½½ â†’ è§£æExcel â†’ æ•°æ®æ¸…æ´— â†’ å»é‡å¤„ç† â†’ ç»Ÿä¸€å­˜å‚¨
     â†“
CSVæ–‡ä»¶ + SQLiteæ•°æ®åº“ + å¤šæ ¼å¼å¯¼å‡º
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### 1. ç™»å½•å¤±è´¥
```bash
# æ£€æŸ¥ç”¨æˆ·åå¯†ç 
# æ‰‹åŠ¨ç™»å½•ç½‘ç«™éªŒè¯è´¦å·çŠ¶æ€
# æ£€æŸ¥ç½‘ç»œè¿æ¥
```

### 2. é€‰æ‹©å™¨å¤±æ•ˆ
```bash
# é‡æ–°è¿è¡Œåˆ†æå·¥å…·
python site_analyzer.py

# æ›´æ–°config.pyä¸­çš„SELECTORS
```

### 3. åˆ†é¡µå¤±è´¥
```bash
# æ£€æŸ¥JavaScriptæ§åˆ¶å°é”™è¯¯
# å¢åŠ ç­‰å¾…æ—¶é—´
# ä½¿ç”¨ä¸åŒçš„åˆ†é¡µæ–¹æ³•
```

### 4. ä¸‹è½½å¤±è´¥
```bash
# æ£€æŸ¥ä¸‹è½½ç›®å½•æƒé™
# ç¡®è®¤å¯¼å‡ºæŒ‰é’®é€‰æ‹©å™¨æ­£ç¡®
# æ£€æŸ¥æ–‡ä»¶æ ¼å¼è®¾ç½®
```

## ğŸ“ˆ ç›‘æ§å’Œè°ƒè¯•

### å®æ—¶ç›‘æ§
```bash
# å¦å¼€ç»ˆç«¯ç›‘æ§è¿›åº¦
python monitor.py

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
python run.py --status
```

### è°ƒè¯•æ¨¡å¼
```python
# åœ¨config.pyä¸­è®¾ç½®
HEADLESS = False  # æ˜¾ç¤ºæµè§ˆå™¨çª—å£
LOG_LEVEL = "DEBUG"  # è¯¦ç»†æ—¥å¿—
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/scraper_*.log

# æŸ¥çœ‹é”™è¯¯ç»Ÿè®¡
python -c "
from error_handler import ErrorHandler
eh = ErrorHandler()
print(eh.get_error_summary())
"
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. åˆ†é˜¶æ®µæµ‹è¯•
```bash
# ç¬¬ä¸€æ¬¡ï¼šæµ‹è¯•1é¡µ
python run.py --start 1 --end 1

# ç¬¬äºŒæ¬¡ï¼šæµ‹è¯•10é¡µ
python run.py --start 1 --end 10

# ç¬¬ä¸‰æ¬¡ï¼šå…¨é‡çˆ¬å–
python run.py
```

### 2. ç½‘ç»œç¨³å®šæ€§
- ä½¿ç”¨ç¨³å®šçš„ç½‘ç»œè¿æ¥
- é¿å…åœ¨ç½‘ç»œé«˜å³°æœŸè¿è¡Œ
- è®¾ç½®åˆé€‚çš„é‡è¯•æ¬¡æ•°

### 3. èµ„æºç®¡ç†
- ç¡®ä¿è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆ1-2GBï¼‰
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶

### 4. æ•°æ®å¤‡ä»½
```bash
# ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½
# æ‰‹åŠ¨å¤‡ä»½é‡è¦æ•°æ®
cp data/combase_master_data.csv backup/
```

## ğŸ“‹ å®Œæˆåçš„æ•°æ®

çˆ¬å–å®Œæˆåï¼Œä½ å°†è·å¾—ï¼š

### ä¸»è¦æ–‡ä»¶
- `data/combase_master_data.csv` - ä¸»æ•°æ®æ–‡ä»¶ï¼ˆæ‰€æœ‰è®°å½•ï¼‰
- `data/combase_data.db` - SQLiteæ•°æ®åº“
- `data/scraping_progress.json` - çˆ¬å–è¿›åº¦è®°å½•

### æ•°æ®æ ¼å¼
æ¯æ¡è®°å½•åŒ…å«ï¼š
- Record ID: å”¯ä¸€æ ‡è¯†
- Organism: å¾®ç”Ÿç‰©åç§°
- Food category: é£Ÿå“ç±»åˆ«
- Food Name: å…·ä½“é£Ÿå“
- Temperature (C): æ¸©åº¦æ¡ä»¶
- Aw: æ°´æ´»åº¦
- pH: é…¸ç¢±åº¦
- Conditions: å®éªŒæ¡ä»¶
- Logcs: æ—¶é—´åºåˆ—æ•°æ®ï¼ˆç”¨äºæ¨¡å‹è®­ç»ƒï¼‰

### ç»Ÿè®¡ä¿¡æ¯
- æ€»è®°å½•æ•°: ~51,000æ¡
- å”¯ä¸€å¾®ç”Ÿç‰©: ~500ç§
- é£Ÿå“ç±»åˆ«: ~50ç§
- æ–‡ä»¶å¤§å°: 100-200MB

## ğŸ‰ ç›´æ¥ç”¨äºæ¨¡å‹è®­ç»ƒ

æ•°æ®å·²ç»è¿‡æ¸…æ´—å’Œæ ‡å‡†åŒ–ï¼Œå¯ä»¥ç›´æ¥ç”¨äºï¼š
- å¾®ç”Ÿç‰©ç”Ÿé•¿é¢„æµ‹æ¨¡å‹
- é£Ÿå“å®‰å…¨é£é™©è¯„ä¼°
- æ¸©åº¦-æ—¶é—´-å¾®ç”Ÿç‰©å…³ç³»å»ºæ¨¡
- æœºå™¨å­¦ä¹ ç‰¹å¾å·¥ç¨‹

```python
# å¿«é€ŸåŠ è½½æ•°æ®è¿›è¡Œåˆ†æ
import pandas as pd
df = pd.read_csv('data/combase_master_data.csv')
print(df.head())
print(df.describe())
```

è¿™ä¸ªè§£å†³æ–¹æ¡ˆå®Œå…¨è§£å†³äº†ä½ æåˆ°çš„URLä¸å˜åŒ–å’Œå¤§é‡æ‰‹åŠ¨æ“ä½œçš„é—®é¢˜ï¼
